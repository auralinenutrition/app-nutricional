{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/app/api/meals/analyze/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport OpenAI from \"openai\";\r\n\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY!,\r\n});\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { imageUrl } = await req.json();\r\n\r\n    const prompt = `\r\nVocê é um nutricionista.\r\nAnalise a refeição da imagem e retorne SOMENTE um JSON PURO e VÁLIDO com:\r\n\r\n{\r\n  \"description\": \"string\",\r\n  \"calories\": number,\r\n  \"protein\": number,\r\n  \"carbs\": number,\r\n  \"fat\": number,\r\n  \"portion_size\": \"string\"\r\n}\r\n\r\nRegras:\r\n- Não adicione explicações.\r\n- Não use markdown.\r\n- Não coloque crases.\r\n- Retorne somente o JSON.\r\n`;\r\n\r\n    const response = await openai.chat.completions.create({\r\n      model: \"gpt-4o\",\r\n      messages: [\r\n        { role: \"system\", content: \"Você é um nutricionista.\" },\r\n        {\r\n          role: \"user\",\r\n          content: [\r\n            { type: \"text\", text: prompt },\r\n            { type: \"image_url\", image_url: { url: imageUrl } }\r\n          ],\r\n        },\r\n      ],\r\n      temperature: 0.1,\r\n      max_tokens: 400,\r\n    });\r\n\r\n    let output = response.choices[0].message.content ?? \"\";\r\n\r\n    // --- LIMPA POSSÍVEIS LIXOS ---\r\n    output = output.trim();\r\n\r\n    // Extrai bloco JSON entre chaves\r\n    const jsonMatch = output.match(/\\{[\\s\\S]*?\\}/);\r\n    if (!jsonMatch) {\r\n      console.error(\"❌ JSON não encontrado na resposta:\", output);\r\n      throw new Error(\"Resposta da IA não contém JSON válido.\");\r\n    }\r\n\r\n    const jsonString = jsonMatch[0];\r\n\r\n    // Faz parse seguro\r\n    const data = JSON.parse(jsonString);\r\n\r\n    return NextResponse.json(data);\r\n\r\n  } catch (err: any) {\r\n    console.error(\"❌ Erro na rota analyze:\", err);\r\n    return NextResponse.json(\r\n      {\r\n        error: \"Erro ao analisar refeição\",\r\n        details: err.message,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,kJAAA,CAAA,UAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnC,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;;;AAkBpB,CAAC;QAEG,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;gBACR;oBAAE,MAAM;oBAAU,SAAS;gBAA2B;gBACtD;oBACE,MAAM;oBACN,SAAS;wBACP;4BAAE,MAAM;4BAAQ,MAAM;wBAAO;wBAC7B;4BAAE,MAAM;4BAAa,WAAW;gCAAE,KAAK;4BAAS;wBAAE;qBACnD;gBACH;aACD;YACD,aAAa;YACb,YAAY;QACd;QAEA,IAAI,SAAS,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,IAAI;QAEpD,gCAAgC;QAChC,SAAS,OAAO,IAAI;QAEpB,iCAAiC;QACjC,MAAM,YAAY,OAAO,KAAK,CAAC;QAC/B,IAAI,CAAC,WAAW;YACd,QAAQ,KAAK,CAAC,sCAAsC;YACpD,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,aAAa,SAAS,CAAC,EAAE;QAE/B,mBAAmB;QACnB,MAAM,OAAO,KAAK,KAAK,CAAC;QAExB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAE3B,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,IAAI,OAAO;QACtB,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}