{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/lib/supabase/server.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\r\nimport { createServerClient } from \"@supabase/ssr\";\r\n\r\nexport async function createServerSupabase() {\r\n  const cookieStore = await cookies();\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value;\r\n        },\r\n        set(name: string, value: string, options?: any) {\r\n          try {\r\n            cookieStore.set(name, value, options);\r\n          } catch {\r\n            // ignore erro em GET\r\n          }\r\n        },\r\n        remove(name: string, options?: any) {\r\n          try {\r\n            cookieStore.delete({ name, ...options });\r\n          } catch {\r\n            // ignore erro em GET\r\n          }\r\n        },\r\n      },\r\n    }\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AAAA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAEhC,OAAO,CAAA,GAAA,yKAAA,CAAA,qBAAkB,AAAD,sUAGtB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAa;gBAC5C,IAAI;oBACF,YAAY,GAAG,CAAC,MAAM,OAAO;gBAC/B,EAAE,OAAM;gBACN,qBAAqB;gBACvB;YACF;YACA,QAAO,IAAY,EAAE,OAAa;gBAChC,IAAI;oBACF,YAAY,MAAM,CAAC;wBAAE;wBAAM,GAAG,OAAO;oBAAC;gBACxC,EAAE,OAAM;gBACN,qBAAqB;gBACvB;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/services/home/loadHomeServer.ts"],"sourcesContent":["// src/services/home/loadHomeServer.ts\r\nimport { createServerSupabase } from \"@/lib/supabase/server\";\r\nimport { AiPlanDays, DayKey } from \"@/types/plan\";\r\n\r\nexport default async function loadHomeServer(userId: string) {\r\n  const supabase = await createServerSupabase();\r\n\r\n  // ------------------------------------\r\n  // 1) Buscar metas do usuário (tabela users)\r\n  // ------------------------------------\r\n  const { data: user, error: userErr } = await supabase\r\n    .from(\"users\")\r\n    .select(\"meta_agua, meta_calorias, meta_refeicoes\")\r\n    .eq(\"id\", userId)\r\n    .single();\r\n\r\n  const metas = {\r\n    metaAgua: user?.meta_agua ?? 2000,\r\n    metaCalorias: user?.meta_calorias ?? 2000,\r\n    metaRefeicoes: user?.meta_refeicoes ?? 4,\r\n  };\r\n\r\n  // ------------------------------------\r\n  // 2) Buscar refeições de hoje\r\n  // ------------------------------------\r\n  const start = new Date();\r\n  start.setHours(0, 0, 0, 0);\r\n\r\n  const { data: mealsToday, error: mealsErr } = await supabase\r\n    .from(\"meals\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", userId)\r\n    .gte(\"created_at\", start.toISOString())\r\n    .order(\"created_at\", { ascending: false });\r\n\r\n  const meals = mealsToday ?? [];\r\n\r\n  const caloriesValue = meals.reduce((sum, m) => sum + (m.calories ?? 0), 0);\r\n\r\n  // ------------------------------------\r\n  // 3) Buscar quantidade de água ingerida hoje\r\n  // (caso não tenha uma tabela water_records ainda, usamos 0)\r\n  // ------------------------------------\r\n  let waterValue = 0;\r\n  const { data: waterRows } = await supabase\r\n    .from(\"water_records\")\r\n    .select(\"amount, created_at\")\r\n    .eq(\"user_id\", userId)\r\n    .gte(\"created_at\", start.toISOString());\r\n\r\n  if (waterRows && waterRows.length > 0) {\r\n    waterValue = waterRows.reduce((s, w) => s + (w.amount ?? 0), 0);\r\n  }\r\n\r\n// ------------------------------------\r\n// 4) Buscar plano semanal gerado pela IA\r\n// ------------------------------------\r\nconst { data: planRow } = await supabase\r\n  .from(\"ai_generated_plans\")\r\n  .select(\"content\")\r\n  .eq(\"user_id\", userId)\r\n  .eq(\"plan_type\", \"weekly_meal_plan\")\r\n  .order(\"created_at\", { ascending: false })\r\n  .limit(1)\r\n  .single();\r\n\r\nconst rawWeek = planRow?.content?.week ?? {};\r\nconst shoppingList = planRow?.content?.shopping_list ?? [];\r\n\r\nconst normalizeMeal = (item: any) => {\r\n  if (typeof item === \"string\") {\r\n    return {\r\n      title: item,\r\n      description: \"\",\r\n      calories: 0,\r\n    };\r\n  }\r\n  return {\r\n    title: String(item?.title ?? \"\"),\r\n    description: String(item?.description ?? \"\"),\r\n    calories: Number(item?.calories ?? 0),\r\n  };\r\n};\r\n\r\n\r\nconst plan: AiPlanDays = {\r\n  domingo: (rawWeek.domingo ?? []).map(normalizeMeal),\r\n  segunda: (rawWeek.segunda ?? []).map(normalizeMeal),\r\n  terca:   (rawWeek.terca ?? []).map(normalizeMeal),\r\n  quarta:  (rawWeek.quarta ?? []).map(normalizeMeal),\r\n  quinta:  (rawWeek.quinta ?? []).map(normalizeMeal),\r\n  sexta:   (rawWeek.sexta ?? []).map(normalizeMeal),\r\n  sabado:  (rawWeek.sabado ?? []).map(normalizeMeal),\r\n};\r\n\r\n\r\n\r\n// ------------------------------------\r\n// 5) Totais de calorias do plano (por dia)\r\n// ------------------------------------\r\nconst totals: Record<DayKey, number> = {\r\n  domingo: 0,\r\n  segunda: 0,\r\n  terca: 0,\r\n  quarta: 0,\r\n  quinta: 0,\r\n  sexta: 0,\r\n  sabado: 0,\r\n};\r\n\r\n(Object.keys(plan) as DayKey[]).forEach((day) => {\r\n  totals[day] = plan[day].reduce((s, m) => s + (m.calories ?? 0), 0);\r\n});\r\n\r\n\r\n  // ------------------------------------\r\n  // 6) Cálculo dos percentuais\r\n  // ------------------------------------\r\n  const waterPercent = Math.min(100, (waterValue / metas.metaAgua) * 100);\r\n  const mealsPercent = Math.min(100, (meals.length / metas.metaRefeicoes) * 100);\r\n  const caloriesPercent = Math.min(100, (caloriesValue / metas.metaCalorias) * 100);\r\n\r\n  return {\r\n    metas,\r\n    meals,\r\n    plan,\r\n    shoppingList,\r\n    totals,\r\n    progress: {\r\n      water: waterPercent,\r\n      meals: mealsPercent,\r\n      calories: caloriesPercent,\r\n      waterValue,\r\n      caloriesValue,\r\n      mealsDone: meals.length,\r\n      metaAgua: metas.metaAgua,\r\n      metaRefeicoes: metas.metaRefeicoes,\r\n      metaCalorias: metas.metaCalorias,\r\n    }\r\n  };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/app/home/HomeClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/home/HomeClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/home/HomeClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,6OAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+R,GAC5T,6DACA","debugId":null}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/app/home/HomeClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/home/HomeClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/home/HomeClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,6OAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2Q,GACxS,yCACA","debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/lib/supabase/getUserServer.ts"],"sourcesContent":["import { createServerSupabase } from \"./server\";\r\n\r\nexport async function getUserServer() {\r\n  const supabase = await createServerSupabase();\r\n  const { data } = await supabase.auth.getUser();\r\n  return { supabase, user: data.user };\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,CAAA,GAAA,gIAAA,CAAA,uBAAoB,AAAD;IAC1C,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC5C,OAAO;QAAE;QAAU,MAAM,KAAK,IAAI;IAAC;AACrC","debugId":null}},
    {"offset": {"line": 217, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/app/home/page.tsx"],"sourcesContent":["// src/app/home/page.tsx\r\n\r\nimport loadHomeServer from \"@/services/home/loadHomeServer\";\r\nimport { redirect } from \"next/navigation\";\r\nimport HomeClient from \"./HomeClient\";\r\nimport { getUserServer } from \"@/lib/supabase/getUserServer\";\r\n\r\nexport default async function HomePage() {\r\n  const { user } = await getUserServer();\r\n\r\n  if (!user) redirect(\"/login\");\r\n\r\n  const data = await loadHomeServer(user.id);\r\n\r\n  return <HomeClient user={user} data={data} />;\r\n}\r\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;AAExB;AACA;AAAA;AACA;AACA;;;;;;AAEe,eAAe;IAC5B,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,CAAA,GAAA,uIAAA,CAAA,gBAAa,AAAD;IAEnC,IAAI,CAAC,MAAM,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE;IAEpB,MAAM,OAAO,MAAM,CAAA,GAAA,yIAAA,CAAA,UAAc,AAAD,EAAE,KAAK,EAAE;IAEzC,qBAAO,8OAAC,iIAAA,CAAA,UAAU;QAAC,MAAM;QAAM,MAAM;;;;;;AACvC","debugId":null}}]
}