{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/services/goals/calculateUserTargets.ts"],"sourcesContent":["// src/services/goals/calculateUserTargets.ts\r\n\r\nexport type QuizDataForTargets = {\r\n  genero: string;\r\n  objetivo: string;\r\n  nivel_treino: string;\r\n  frequencia_treino: string;\r\n  peso_atual: number;\r\n  altura: number;\r\n  peso_desejado: number;\r\n  refeicoes_dia: string;\r\n  alergias: string[];\r\n  alimentacao_atual: string;\r\n};\r\n\r\nexport type UserTargets = {\r\n  daily_calorie_goal: number;\r\n  daily_protein_goal: number;\r\n  daily_water_goal: number;\r\n  daily_meals_goal: number;\r\n  diet_type: string;\r\n};\r\n\r\n/** Fator de atividade baseado no nível do usuário */\r\nfunction activityFactor(nivel: string, freq: string): number {\r\n  if (nivel === \"Iniciante\") return 1.4;\r\n  if (nivel === \"Intermediário\") return 1.55;\r\n  if (nivel === \"Avançado\") return 1.7;\r\n\r\n  // fallback básico\r\n  return 1.5;\r\n}\r\n\r\n/** Classificação de dieta baseada em alergias e padrão alimentar */\r\nfunction detectDietType(payload: QuizDataForTargets): string {\r\n  const allergies = payload.alergias.map(a => a.toLowerCase());\r\n\r\n  if (allergies.includes(\"lactose\")) return \"dairy_free\";\r\n  if (allergies.includes(\"glúten\")) return \"gluten_free\";\r\n  if (allergies.includes(\"nenhuma alergia/intolerância\")) return \"balanced\";\r\n\r\n  // alimentação muito ruim ou muito boa pode afetar estilo\r\n  if (payload.alimentacao_atual === \"Muito mal\" || payload.alimentacao_atual === \"Mal\") {\r\n    return \"balanced_simple\"; // dieta mais simples e fácil de seguir\r\n  }\r\n\r\n  return \"balanced\";\r\n}\r\n\r\nexport function calculateUserTargets(payload: QuizDataForTargets): UserTargets {\r\n  const peso = payload.peso_atual;\r\n  const altura = payload.altura;\r\n  const idade = 25; // opcional melhorar depois\r\n  const genero = payload.genero.toLowerCase();\r\n\r\n  // Fórmula Mifflin-St Jeor (mais usada atualmente)\r\n  let TMB =\r\n    genero === \"masculino\"\r\n      ? 10 * peso + 6.25 * altura - 5 * idade + 5\r\n      : 10 * peso + 6.25 * altura - 5 * idade - 161;\r\n\r\n  const AF = activityFactor(payload.nivel_treino, payload.frequencia_treino);\r\n\r\n  const TDEE = TMB * AF;\r\n\r\n  // ajuste metas conforme objetivo\r\n  let dailyCalories = TDEE;\r\n\r\n  if (payload.objetivo === \"Perder peso\") {\r\n    dailyCalories = TDEE - 350;\r\n  } else if (payload.objetivo === \"Ganhar massa muscular\") {\r\n    dailyCalories = TDEE + 300;\r\n  }\r\n\r\n  // proteína (meta simples)\r\n  const dailyProtein = Math.round(peso * 1.8);\r\n\r\n  // água (meta simples)\r\n  const dailyWater = peso * 35; // ml\r\n\r\n  const meals = Number(payload.refeicoes_dia.replace(/\\D/g, \"\")) || 4;\r\n\r\n  const dietType = detectDietType(payload);\r\n\r\n  return {\r\n    daily_calorie_goal: Math.round(dailyCalories),\r\n    daily_protein_goal: dailyProtein,\r\n    daily_water_goal: Math.round(dailyWater),\r\n    daily_meals_goal: meals,\r\n    diet_type: dietType,\r\n  };\r\n}\r\n"],"names":[],"mappings":"AAAA,6CAA6C;;;;AAuB7C,mDAAmD,GACnD,SAAS,eAAe,KAAa,EAAE,IAAY;IACjD,IAAI,UAAU,aAAa,OAAO;IAClC,IAAI,UAAU,iBAAiB,OAAO;IACtC,IAAI,UAAU,YAAY,OAAO;IAEjC,kBAAkB;IAClB,OAAO;AACT;AAEA,kEAAkE,GAClE,SAAS,eAAe,OAA2B;IACjD,MAAM,YAAY,QAAQ,QAAQ,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW;IAEzD,IAAI,UAAU,QAAQ,CAAC,YAAY,OAAO;IAC1C,IAAI,UAAU,QAAQ,CAAC,WAAW,OAAO;IACzC,IAAI,UAAU,QAAQ,CAAC,iCAAiC,OAAO;IAE/D,yDAAyD;IACzD,IAAI,QAAQ,iBAAiB,KAAK,eAAe,QAAQ,iBAAiB,KAAK,OAAO;QACpF,OAAO,mBAAmB,uCAAuC;IACnE;IAEA,OAAO;AACT;AAEO,SAAS,qBAAqB,OAA2B;IAC9D,MAAM,OAAO,QAAQ,UAAU;IAC/B,MAAM,SAAS,QAAQ,MAAM;IAC7B,MAAM,QAAQ,IAAI,2BAA2B;IAC7C,MAAM,SAAS,QAAQ,MAAM,CAAC,WAAW;IAEzC,kDAAkD;IAClD,IAAI,MACF,WAAW,cACP,KAAK,OAAO,OAAO,SAAS,IAAI,QAAQ,IACxC,KAAK,OAAO,OAAO,SAAS,IAAI,QAAQ;IAE9C,MAAM,KAAK,eAAe,QAAQ,YAAY,EAAE,QAAQ,iBAAiB;IAEzE,MAAM,OAAO,MAAM;IAEnB,iCAAiC;IACjC,IAAI,gBAAgB;IAEpB,IAAI,QAAQ,QAAQ,KAAK,eAAe;QACtC,gBAAgB,OAAO;IACzB,OAAO,IAAI,QAAQ,QAAQ,KAAK,yBAAyB;QACvD,gBAAgB,OAAO;IACzB;IAEA,0BAA0B;IAC1B,MAAM,eAAe,KAAK,KAAK,CAAC,OAAO;IAEvC,sBAAsB;IACtB,MAAM,aAAa,OAAO,IAAI,KAAK;IAEnC,MAAM,QAAQ,OAAO,QAAQ,aAAa,CAAC,OAAO,CAAC,OAAO,QAAQ;IAElE,MAAM,WAAW,eAAe;IAEhC,OAAO;QACL,oBAAoB,KAAK,KAAK,CAAC;QAC/B,oBAAoB;QACpB,kBAAkB,KAAK,KAAK,CAAC;QAC7B,kBAAkB;QAClB,WAAW;IACb;AACF","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/services/goals/saveUserTargets.ts"],"sourcesContent":["// src/services/goals/saveUserTargets.ts\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { UserTargets } from \"./calculateUserTargets\";\r\n\r\nexport async function saveUserTargets(userId: string, targets: UserTargets) {\r\n  const { error } = await supabase\r\n    .from(\"users\")\r\n    .update({\r\n      daily_calorie_goal: targets.daily_calorie_goal,\r\n      daily_protein_goal: targets.daily_protein_goal,\r\n      daily_water_goal: targets.daily_water_goal,\r\n      daily_meals_goal: targets.daily_meals_goal,\r\n      diet_type: targets.diet_type,\r\n    })\r\n    .eq(\"id\", userId);\r\n\r\n  if (error) {\r\n    console.error(\"Erro ao salvar metas:\", error);\r\n    throw new Error(error.message);\r\n  }\r\n\r\n  return true;\r\n}\r\n"],"names":[],"mappings":"AAAA,wCAAwC;;;;AACxC;;AAGO,eAAe,gBAAgB,MAAc,EAAE,OAAoB;IACxE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CAC7B,IAAI,CAAC,SACL,MAAM,CAAC;QACN,oBAAoB,QAAQ,kBAAkB;QAC9C,oBAAoB,QAAQ,kBAAkB;QAC9C,kBAAkB,QAAQ,gBAAgB;QAC1C,kBAAkB,QAAQ,gBAAgB;QAC1C,WAAW,QAAQ,SAAS;IAC9B,GACC,EAAE,CAAC,MAAM;IAEZ,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,IAAI,MAAM,MAAM,OAAO;IAC/B;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/services/quiz/quizService.tsx"],"sourcesContent":["// /services/quizService.ts\r\n\"use client\";\r\n\r\nimport { supabase } from \"@/lib/supabase\";\r\n\r\n/**\r\n * Tipagem do payload do quiz (resumida a partir do seu prompt mestre).\r\n * Adapte se você tiver nomes diferentes.\r\n */\r\nexport type QuizPayload = {\r\n  objetivo: string;\r\n  nivel_treino: string;\r\n  frequencia_treino: string;\r\n  horario_treino: string;\r\n  alimentacao_atual: string;\r\n  refeicoes_dia: string;\r\n  rotina_trabalho: string[]; // multiple choice\r\n  nivel_disciplina: string;\r\n  dificuldade_principal: string[]; // multiple choice\r\n  horario_dificil: string;\r\n  agua: string;\r\n  sono: string;\r\n  tentou_dieta: string;\r\n  expectativa: string;\r\n  prazo_resultado: string;\r\n  peso_atual: number;\r\n  altura: number;\r\n  peso_desejado: number;\r\n  alergias: string[]; // multiple\r\n};\r\n\r\n/**\r\n * Resultado padrão das funções (sucesso / erro).\r\n */\r\ntype ServiceResult<T> =\r\n  | { success: true; data: T }\r\n  | { success: false; error: string };\r\n\r\n/**\r\n * Salva as respostas do quiz na tabela `quiz_responses`.\r\n * - userId: id do usuário (string)\r\n * - payload: respostas do quiz\r\n */\r\nexport async function saveQuizResponses(\r\n  userId: string,\r\n  payload: QuizPayload\r\n): Promise<ServiceResult<any>> {\r\n  try {\r\n    const toInsert = {\r\n      user_id: userId,\r\n      objetivo: payload.objetivo,\r\n      nivel_treino: payload.nivel_treino,\r\n      frequencia_treino: payload.frequencia_treino,\r\n      horario_treino: payload.horario_treino,\r\n      alimentacao_atual: payload.alimentacao_atual,\r\n      refeicoes_dia: payload.refeicoes_dia,\r\n      rotina_trabalho: payload.rotina_trabalho,\r\n      nivel_disciplina: payload.nivel_disciplina,\r\n      dificuldade_principal: payload.dificuldade_principal,\r\n      horario_dificil: payload.horario_dificil,\r\n      agua: payload.agua,\r\n      sono: payload.sono,\r\n      tentou_dieta: payload.tentou_dieta,\r\n      expectativa: payload.expectativa,\r\n      prazo_resultado: payload.prazo_resultado,\r\n      peso_atual: payload.peso_atual,\r\n      altura: payload.altura,\r\n      peso_desejado: payload.peso_desejado,\r\n      alergias: payload.alergias,\r\n      created_at: new Date().toISOString(),\r\n    };\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"quiz_responses\")\r\n      .insert([toInsert])\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (err: any) {\r\n    return { success: false, error: err.message || \"Erro desconhecido\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Atualiza a tabela `users` com os campos principais vindos do quiz.\r\n * - userId: id do usuário\r\n * - payload: subset de campos do quiz (peso/altura/objetivo/nivel/frequencia)\r\n */\r\nexport async function updateUserFromQuiz(\r\n  userId: string,\r\n  payload: Partial<QuizPayload>\r\n): Promise<ServiceResult<any>> {\r\n  try {\r\n    const updateObj: Record<string, any> = {};\r\n\r\n    if (typeof payload.peso_atual === \"number\")\r\n      updateObj.peso_atual = payload.peso_atual;\r\n    if (typeof payload.peso_desejado === \"number\")\r\n      updateObj.peso_desejado = payload.peso_desejado;\r\n    if (typeof payload.peso_atual === \"number\")\r\n      updateObj.peso_inicial = payload.peso_atual; // definir peso_inicial no primeiro quiz\r\n    if (typeof payload.altura === \"number\") updateObj.altura = payload.altura;\r\n    if (payload.objetivo) updateObj.objetivo = payload.objetivo;\r\n    if (payload.nivel_treino) updateObj.nivel_treino = payload.nivel_treino;\r\n    if (payload.frequencia_treino)\r\n      updateObj.frequencia_semanal = payload.frequencia_treino;\r\n\r\n    // Se não houver nada a atualizar:\r\n    if (Object.keys(updateObj).length === 0) {\r\n      return { success: false, error: \"Nenhum campo para atualizar\" };\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"users\")\r\n      .update(updateObj)\r\n      .eq(\"id\", userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) return { success: false, error: error.message };\r\n\r\n    return { success: true, data };\r\n  } catch (err: any) {\r\n    return { success: false, error: err.message || \"Erro desconhecido\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Gera uma projeção linear de peso ao longo de N semanas.\r\n * - pesoAtual: número\r\n * - pesoDesejado: número\r\n * - weeks: número de semanas (padrão 12)\r\n *\r\n * Retorna um array de objetos: [{ week: 0, weight: 80 }, { week: 1, weight: 79.2 }, ...]\r\n *\r\n * Observação: isso é uma projeção linear simples. Ajuste a lógica conforme desejar.\r\n */\r\nexport function calculateWeightProjection(\r\n  pesoAtual: number,\r\n  pesoDesejado: number,\r\n  weeks = 12\r\n): { week: number; weight: number }[] {\r\n  // Evita divisão por zero\r\n  const w = Math.max(1, Math.floor(weeks));\r\n  const diff = pesoDesejado - pesoAtual;\r\n  const step = diff / w;\r\n\r\n  const arr: { week: number; weight: number }[] = [];\r\n  for (let i = 0; i <= w; i++) {\r\n    const weight = +(pesoAtual + step * i).toFixed(1); // 1 casa decimal\r\n    arr.push({ week: i, weight });\r\n  }\r\n  return arr;\r\n}\r\n\r\n/**\r\n * Gera benefícios motivacionais simples com base nas respostas do quiz.\r\n * Pode ser usado para preencher a tela de resultado enquanto integraremos OpenAI.\r\n */\r\nexport function generateMotivationalBenefits(payload: QuizPayload): string[] {\r\n  const benefits: string[] = [];\r\n\r\n  // objetivo\r\n  if (/emagrec|perder/i.test(payload.objetivo)) {\r\n    benefits.push(\r\n      \"Plano focado em queima de gordura com metas semanais realistas.\"\r\n    );\r\n  } else if (/massa|ganhar/i.test(payload.objetivo)) {\r\n    benefits.push(\r\n      \"Plano orientado para ganho de massa com equilíbrio calórico e proteína.\"\r\n    );\r\n  } else {\r\n    benefits.push(\r\n      \"Plano personalizado para manutenção e hábitos consistentes.\"\r\n    );\r\n  }\r\n\r\n  // nível de treino\r\n  if (/iniciante|beginner/i.test(payload.nivel_treino)) {\r\n    benefits.push(\r\n      \"Treinos iniciais fáceis de seguir — ideal para começar sem lesões.\"\r\n    );\r\n  } else if (/intermedi|médio/i.test(payload.nivel_treino)) {\r\n    benefits.push(\"Treinos moderados para acelerar progresso com segurança.\");\r\n  } else {\r\n    benefits.push(\"Treinos avançados para quem busca evolução consistente.\");\r\n  }\r\n\r\n  // água / sono\r\n  if (Number(payload.agua) < 6 || /pouco/i.test(payload.agua)) {\r\n    benefits.push(\"Dicas práticas para aumentar sua hidratação diária.\");\r\n  }\r\n  if (Number(payload.sono) < 7 || /pouco/i.test(payload.sono)) {\r\n    benefits.push(\r\n      \"Estratégias para melhorar a qualidade do sono e recuperação.\"\r\n    );\r\n  }\r\n\r\n  // dificuldades / disciplina\r\n  if (payload.dificuldade_principal?.length) {\r\n    benefits.push(\r\n      `Soluções rápidas para ${payload.dificuldade_principal\r\n        .slice(0, 2)\r\n        .join(\", \")}.`\r\n    );\r\n  }\r\n\r\n  // expectativa / prazo\r\n  if (/rápido|30 dias|um mês|1 mês/i.test(payload.prazo_resultado)) {\r\n    benefits.push(\r\n      \"Metas realistas: pequenas vitórias semanais são mais sustentáveis.\"\r\n    );\r\n  }\r\n\r\n  // fallback\r\n  if (benefits.length === 0) {\r\n    benefits.push(\r\n      \"Plano personalizado e progressivo para te ajudar diariamente.\"\r\n    );\r\n  }\r\n\r\n  return benefits;\r\n}\r\n\r\n/**\r\n * EXEMPLO DE USO (pseudo-code)\r\n *\r\n * // 1) Salvar quiz responses\r\n * const res = await saveQuizResponses(userId, quizPayload);\r\n * if (!res.success) console.error(res.error);\r\n *\r\n * // 2) Atualizar user\r\n * const up = await updateUserFromQuiz(userId, quizPayload);\r\n * if (!up.success) console.error(up.error);\r\n *\r\n * // 3) Gerar projeção\r\n * const proj = calculateWeightProjection(quizPayload.peso_atual, quizPayload.peso_desejado, 12);\r\n *\r\n * // 4) Gerar benefícios\r\n * const benefits = generateMotivationalBenefits(quizPayload);\r\n *\r\n * // Use proj + benefits para popular a tela de resultado.\r\n */\r\n\r\nexport default {\r\n  saveQuizResponses,\r\n  updateUserFromQuiz,\r\n  calculateWeightProjection,\r\n  generateMotivationalBenefits,\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/services/quiz/finishQuizAfterSignup.ts"],"sourcesContent":["import { supabase } from \"@/lib/supabase\";\r\nimport { calculateUserTargets } from \"../goals/calculateUserTargets\";\r\nimport { saveUserTargets } from \"../goals/saveUserTargets\";\r\nimport quizService from \"./quizService\";\r\n\r\nexport async function finishQuizAfterSignup(userId: string) {\r\n  const raw = localStorage.getItem(\"quizData\");\r\n  if (!raw) return;\r\n\r\n  const quizData = JSON.parse(raw);\r\n\r\n  const payload = {\r\n    ...quizData,\r\n    peso_atual: Number(quizData.peso_atual),\r\n    peso_desejado: Number(quizData.peso_desejado),\r\n    altura: Number(quizData.altura),\r\n  };\r\n\r\n  // 1) Salvar quiz responses\r\n  await quizService.saveQuizResponses(userId, payload);\r\n\r\n  // 2) Atualizar tabela users\r\n  await supabase\r\n    .from(\"users\")\r\n    .update({\r\n      peso_atual: payload.peso_atual,\r\n      peso_inicial: payload.peso_atual,\r\n      peso_desejado: payload.peso_desejado,\r\n      altura: payload.altura,\r\n      objetivo: payload.objetivo,\r\n      nivel_treino: payload.nivel_treino,\r\n      frequencia_semanal: payload.frequencia_treino,\r\n    })\r\n    .eq(\"id\", userId);\r\n\r\n  // 3) Calcular e salvar metas\r\n  const targets = calculateUserTargets(payload);\r\n  await saveUserTargets(userId, targets);\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,sBAAsB,MAAc;IACxD,MAAM,MAAM,aAAa,OAAO,CAAC;IACjC,IAAI,CAAC,KAAK;IAEV,MAAM,WAAW,KAAK,KAAK,CAAC;IAE5B,MAAM,UAAU;QACd,GAAG,QAAQ;QACX,YAAY,OAAO,SAAS,UAAU;QACtC,eAAe,OAAO,SAAS,aAAa;QAC5C,QAAQ,OAAO,SAAS,MAAM;IAChC;IAEA,2BAA2B;IAC3B,MAAM,0IAAA,CAAA,UAAW,CAAC,iBAAiB,CAAC,QAAQ;IAE5C,4BAA4B;IAC5B,MAAM,yHAAA,CAAA,WAAQ,CACX,IAAI,CAAC,SACL,MAAM,CAAC;QACN,YAAY,QAAQ,UAAU;QAC9B,cAAc,QAAQ,UAAU;QAChC,eAAe,QAAQ,aAAa;QACpC,QAAQ,QAAQ,MAAM;QACtB,UAAU,QAAQ,QAAQ;QAC1B,cAAc,QAAQ,YAAY;QAClC,oBAAoB,QAAQ,iBAAiB;IAC/C,GACC,EAAE,CAAC,MAAM;IAEZ,6BAA6B;IAC7B,MAAM,UAAU,CAAA,GAAA,mJAAA,CAAA,uBAAoB,AAAD,EAAE;IACrC,MAAM,CAAA,GAAA,8IAAA,CAAA,kBAAe,AAAD,EAAE,QAAQ;AAChC","debugId":null}},
    {"offset": {"line": 303, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/src/app/signup/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase\";\r\n\r\nimport AInput from \"@/components/ui/AInput\";\r\nimport AButton from \"@/components/ui/AButton\";\r\nimport { finishQuizAfterSignup } from \"@/services/quiz/finishQuizAfterSignup\";\r\n\r\nexport default function SignupPage() {\r\n  const router = useRouter();\r\n\r\n  const [nome, setNome] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [senha, setSenha] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSignup = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // 1) Criar usuário no Supabase Auth\r\n      const { data, error } = await supabase.auth.signUp({\r\n        email,\r\n        password: senha,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      const userId = data.user?.id;\r\n      if (!userId) throw new Error(\"Erro ao localizar usuário.\");\r\n\r\n      // 2) Pegar plano selecionado\r\n      const plano =\r\n        new URLSearchParams(window.location.search).get(\"plano\") ?? \"free\";\r\n\r\n      // 3) Criar user no banco usando service role\r\n      const res = await fetch(\"/api/users/create\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ userId, name: nome, email, plan: plano }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json().catch(() => ({}));\r\n        throw new Error(err.error || \"Erro ao salvar usuário no banco.\");\r\n      }\r\n\r\n      // 4) Salvar quiz\r\n      await finishQuizAfterSignup(userId);\r\n\r\n      const planResp = await fetch(\"/api/ai/generate-plan\", { method: \"POST\" });\r\n\r\n    if (!planResp.ok) {\r\n      console.error(\"Falha ao gerar plano\", await planResp.text());\r\n    }\r\n\r\n      // 5) Limpar\r\n      localStorage.removeItem(\"quizData\");\r\n      localStorage.removeItem(\"quiz_completed\");\r\n\r\n      // 6) Redirecionar\r\n      router.push(\"/home\");\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      alert(err.message || \"Erro ao criar conta.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen w-full flex items-center justify-center p-6\">\r\n      <div className=\"w-full max-w-sm flex flex-col gap-6\">\r\n        <h1 className=\"text-3xl font-bold text-[#0A0A0A]\">Criar conta</h1>\r\n\r\n        <div className=\"flex flex-col gap-4\">\r\n          <AInput\r\n            label=\"Nome\"\r\n            value={nome}\r\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\r\n              setNome(e.target.value)\r\n            }\r\n          />\r\n\r\n          <AInput\r\n            label=\"Email\"\r\n            type=\"email\"\r\n            value={email}\r\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\r\n              setEmail(e.target.value)\r\n            }\r\n          />\r\n\r\n          <AInput\r\n            label=\"Senha\"\r\n            type=\"password\"\r\n            value={senha}\r\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\r\n              setSenha(e.target.value)\r\n            }\r\n          />\r\n\r\n          <AButton type=\"button\" onClick={handleSignup}>\r\n            {loading ? \"Criando conta...\" : \"Criar conta\"}\r\n          </AButton>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;AACA;AACA;;;AARA;;;;;;;AAUe,SAAS;;IACtB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IAEvB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,eAAe;QACnB,IAAI;gBAWa;YAVf,WAAW;YAEX,oCAAoC;YACpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;gBACjD;gBACA,UAAU;YACZ;YAEA,IAAI,OAAO,MAAM;YAEjB,MAAM,UAAS,aAAA,KAAK,IAAI,cAAT,iCAAA,WAAW,EAAE;YAC5B,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;gBAI3B;YAFF,6BAA6B;YAC7B,MAAM,QACJ,CAAA,OAAA,IAAI,gBAAgB,OAAO,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,sBAAhD,kBAAA,OAA4D;YAE9D,6CAA6C;YAC7C,MAAM,MAAM,MAAM,MAAM,qBAAqB;gBAC3C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;oBAAQ,MAAM;oBAAM;oBAAO,MAAM;gBAAM;YAChE;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,MAAM,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;gBAC5C,MAAM,IAAI,MAAM,IAAI,KAAK,IAAI;YAC/B;YAEA,iBAAiB;YACjB,MAAM,CAAA,GAAA,mJAAA,CAAA,wBAAqB,AAAD,EAAE;YAE5B,MAAM,WAAW,MAAM,MAAM,yBAAyB;gBAAE,QAAQ;YAAO;YAEzE,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,QAAQ,KAAK,CAAC,wBAAwB,MAAM,SAAS,IAAI;YAC3D;YAEE,YAAY;YACZ,aAAa,UAAU,CAAC;YACxB,aAAa,UAAU,CAAC;YAExB,kBAAkB;YAClB,OAAO,IAAI,CAAC;QACd,EAAE,OAAO,KAAU;YACjB,QAAQ,KAAK,CAAC;YACd,MAAM,IAAI,OAAO,IAAI;QACvB,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAG,WAAU;8BAAoC;;;;;;8BAElD,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,qIAAA,CAAA,UAAM;4BACL,OAAM;4BACN,OAAO;4BACP,UAAU,CAAC,IACT,QAAQ,EAAE,MAAM,CAAC,KAAK;;;;;;sCAI1B,6LAAC,qIAAA,CAAA,UAAM;4BACL,OAAM;4BACN,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IACT,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;sCAI3B,6LAAC,qIAAA,CAAA,UAAM;4BACL,OAAM;4BACN,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IACT,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;sCAI3B,6LAAC,sIAAA,CAAA,UAAO;4BAAC,MAAK;4BAAS,SAAS;sCAC7B,UAAU,qBAAqB;;;;;;;;;;;;;;;;;;;;;;;AAM5C;GArGwB;;QACP,qIAAA,CAAA,YAAS;;;KADF","debugId":null}},
    {"offset": {"line": 469, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kaiky/OneDrive/%C3%81rea%20de%20Trabalho/Auraline/app-nutricional/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}